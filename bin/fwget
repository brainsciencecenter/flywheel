#!/usr/bin/env python3

import argparse
import flywheel
import fwgearutils
import json
import os
import re
import sys


if __name__ == '__main__':

    import argparse

    CmdName = os.path.basename(sys.argv[0])
    Containers = []

    ap = argparse.ArgumentParser()
    ap.add_argument('-d', '--device-get', default=False,  action='store_true', help='get device info')
    ap.add_argument('-l', '--localtime',  action='store_true', default=False, help='print times in local timezone instead of UTC')
    ap.add_argument('-u', '--get-all-users', default=False,  action='store_true', help='all user info')

    ap.add_argument('id', nargs='*', type=str, default=None, help='group/project|ProjectID')

    args = ap.parse_args()

    fw = fwgearutils.getFW(args, Root=True)
    if (not fw):
        print("%s : unable to initialize flywheel object" % (CmdName), file=sys.stderr)
        sys.exit(1)

    try:
        if (args.device_get):
            Container = fw.get_device(args.id[0])
        elif (args.get_all_users):
            Container = fw.get_all_users()
        else:
            Container = fw.get(args.id[0])

        Containers.append(Container)

    except (OSError, Exception) as e:
        print("e",e, file=sys.stderr)
        sys.exit(1)

    print(json.dumps(fwgearutils.sloppyCopy(Containers,UTC=(not args.localtime)), indent=2))
