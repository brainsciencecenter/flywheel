#!/bin/bash

DicomDictPy=~/Downloads/_dicom_dict.py


DicomTypes='{
	  "AE": { "Type": "Application Entity", "Empty": "", "Entered": "Text" }
	, "AS": { "Type": "Age String", "Empty": "", "Entered": "666Y" }
	, "AT": { "Type": "Attriubte Tag", "Empty": "", "Entered": "", "Review": "Needed" }
	, "CS": { "Type": "Code String", "Empty": "", "Entered": "Long Text" }
        , "DA": { "Type": "Date", "Empty": "1970-01-01", "Entered": "2100-12-31" }
        , "DS": { "Type": "Decimal String", "Empty": "", "Entered": "Long Text" }
	, "DT": { "Type": "DateTime", "Empty": "", "Entered": "19700101000000.000000+0000" }
	, "FD": { "Type": "Floating Point Double", "Empty": "", "Entered": "666.0" }
	, "FL": { "Type": "Floating Point Single", "Empty": "", "Entered": "666.0" }
	, "IS": { "Type": "Integer String", "Empty": "", "Entered": "666" }
        , "LO": { "Type": "Long String", "Empty": "", "Entered": "Text" }
	, "LT": { "Type": "Long Text", "Empty": "", "Entered": "Text" }
	, "OB": { "Type": "Other Byte String", "Empty": "", "Entered": "Text" }
	, "OB or OW": { "Type": "", "Empty": "", "Entered": "" }
	, "OD": { "Type": "Other Double String", "Empty": "", "Entered": "666.0" }
	, "OF": { "Type": "Other Float String", "Empty": "", "Entered": "666.0" }
	, "OL": { "Type": "", "Empty": "", "Entered": "", "Review": "Needed" }
	, "OV": { "Type": "", "Empty": "", "Entered": "", "Review": "Needed" }
	, "OW": { "Type": "Other Word String", "Empty": "", "Entered": "Text" }
        , "PN": { "Type": "Person Name", "Empty": "", "Entered": "George McFoo" }
        , "SH": { "Type": "Short String", "Empty": "", "Entered": "String" }
	, "SL": { "Type": "Signed Long", "Empty": "", "Entered": 666 }
        , "SQ": { "Type": "Sequence of Items", "Empty": "", "Entered": "Long Text", "Review": "Needed" }
	, "SS": { "Type": "Signed Short", "Empty": "", "Entered": -666 }
        , "ST": { "Type": "Sort Text", "Empty": "", "Entered": "Text" }
	, "SV": { "Type": "", "Empty": "", "Entered": "", "Review": "Needed" }
        , "TM": { "Type": "Time", "Empty": "", "Entered": "11:59:59" }
	, "UC": { "Type": "", "Empty": "", "Entered": "", "Review": "Needed" }
	, "UI": { "Type": "Unique Identifier", "Empty": "", "Entered": "666" }
	, "UL": { "Type": "Unsigned Long", "Empty": "", "Entered": "666" }
	, "UN": { "Type": "Unknown", "Empty": "", "Entered": "Text" }
	, "UR": { "Type": "", "Empty": "", "Entered": "" }
        , "US": { "Type": "Unsigned Short", "Empty": 0, "Entered": 666 }
	, "US or OW": { "Type": "", "Empty": "", "Entered": "", "Review": "Needed" }
	, "US or SS": { "Type": "", "Empty": "", "Entered": "", "Review": "Needed" }
	, "US or SS or OW": { "Type": "", "Empty": "", "Entered": "", "Review": "Needed" }
	, "UT": { "Type": "", "Empty": "", "Entered": "Text" }
	, "UV": { "Type": "", "Empty": "", "Entered": "", "Review": "Needed" }
}'

function DicomDictPy2Json {
(
   echo VR,VM,Name,Retired,Keyword
   grep "0x" "$DicomDictPy" | sed 's/^[^(]*(//; '"s/'/\"/g"'; s/)[^)]*$//; s/, /,/g'  
) | grep -v '^"NONE",' | csvjson | jq '[ .[] | select(.Keyword != null) | { (.Keyword) : . } ] | add' 
}

function testDicomTypes {
    echo "$DicomTypes" | grep -v '#' | jq '.'
    exit "$?"
}

#testDicomTypes

DicomDictPy2Json | jq --argjson Types "$DicomTypes" '[ to_entries[] | { "key": .key, "value": (.value + $Types[.value.VR]) }] | from_entries'

