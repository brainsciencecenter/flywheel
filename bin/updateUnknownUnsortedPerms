#!/bin/bash

AllUsers=$(fwget -u | jq -r '.[][] | select(.disabled != true) | ._id' | grep -P '@(pennbrain.)?upenn.edu' | sort -u)
UnknownUsers=$(fw-groupcrud get -mi unknown | tail -n +3 | cut -f 2 -d : | grep -P '@(pennbrain.)?upenn.edu' | sort -u)
UsersToAdd=$(diff <(echo "$AllUsers") <(echo "$UnknownUsers") | grep '<' | sed 's/< //')

if [ -n "$UsersToAdd" ]
then
    fw-groupcrud -v update -g unknown -F -p Unsorted -r read-only $UsersToAdd
else
    echo "No users to add to unknown/Unsorted"
fi

